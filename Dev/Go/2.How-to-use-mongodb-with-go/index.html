<!DOCTYPE html>
<html lang="ko" class="js csstransforms3d" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="description" content="MongoDB를 Docker Compose 로 구동한 후에 Go Package를 이용해서 MongoDB에 접속하는 방법을 정리하고 있습니다.">
<meta name="author" content="MSFL">


<meta property="og:title" content="Golang으로 MongoDB 연결해 보기">

    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2020-01-07">

    <meta property="og:description" content="MongoDB를 Docker Compose 로 구동한 후에 Go Package를 이용해서 MongoDB에 접속하는 방법을 정리하고 있습니다.">
    <meta property="og:url" content="http://ccambo.github.io/Dev/Go/2.How-to-use-mongodb-with-go/">
    <meta property="og:site_name" content="[ MSFL-지식 저장소 ]">


    <meta property="og:tags" content="MongoDB">

    <meta property="og:tags" content="mongo-driver">

    <meta property="og:tags" content="docker-compose">



    <link rel="icon" href="/images/favicon.png" type="image/png">

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-83841390-5', 'auto');
	
	ga('send', 'pageview');
}
</script>

    <title>Golang으로 MongoDB 연결해 보기 :: [ MSFL-지식 저장소 ]</title>

    
    <link href="/css/nucleus.css?1580172898" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1580172898" rel="stylesheet">
    <link href="/css/hybrid.css?1580172898" rel="stylesheet">
    <link href="/css/featherlight.min.css?1580172898" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1580172898" rel="stylesheet">
    <link href="/css/auto-complete.css?1580172898" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1580172898" rel="stylesheet">
    <link href="/css/theme.css?1580172898" rel="stylesheet">
    <link href="/css/hugo-theme.css?1580172898" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1580172898"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <script data-ad-client="ca-pub-1122795820579236" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>
  <body class="" data-url="/Dev/Go/2.How-to-use-mongodb-with-go/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
   <img src="/images/logo.png" alt="[ MSFL-지식 저장소 ]">
   <span>[ MSFL-지식 저장소 ]</span>
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1580172898"></script>
<script type="text/javascript" src="/js/auto-complete.js?1580172898"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/ccambo.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1580172898"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/Git/" title="Git" class="dd-item 
        
        
        
        ">
      <a href="/Git/">
          <b>1. </b>Git
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/Git/Basics/" title="Basics" class="dd-item 
        
        
        parent
        ">
      <a href="/Git/Basics/">
          Basics
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Git/Submdule/" title="Submodule" class="dd-item 
        
        
        
        ">
      <a href="/Git/Submdule/">
          Submodule
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Git/Submdule/what-is-the-submodule/" title="What is the submodule" class="dd-item ">
        <a href="/Git/Submdule/what-is-the-submodule/">
        What is the submodule
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Git/Tips/" title="Tips" class="dd-item 
        
        
        
        ">
      <a href="/Git/Tips/">
          Tips
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Git/Tips/how-to-change-users/" title="How to Change Users" class="dd-item ">
        <a href="/Git/Tips/how-to-change-users/">
        How to Change Users
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Cloud/" title="Cloud" class="dd-item 
        
        
        
        ">
      <a href="/Cloud/">
          <b>2. </b>Cloud
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/Cloud/Concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/Cloud/Concepts/">
          Concepts
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Cloud/Concepts/edge-computing/" title="Edge Computing" class="dd-item ">
        <a href="/Cloud/Concepts/edge-computing/">
        Edge Computing
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Cloud/Docker/" title="Docker" class="dd-item 
        
        
        
        ">
      <a href="/Cloud/Docker/">
          Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/Cloud/Docker/Tips/" title="Tips" class="dd-item 
        
        
        
        ">
      <a href="/Cloud/Docker/Tips/">
          Tips
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Cloud/Kubernetes/" title="Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/Cloud/Kubernetes/">
          Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Dev/" title="Dev" class="dd-item 
        parent
        
        
        ">
      <a href="/Dev/">
          <b>3. </b>Dev
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/Dev/Vue/" title="Vue" class="dd-item 
        
        
        
        ">
      <a href="/Dev/Vue/">
          Vue
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Dev/Vue/1.intro_key_of_vue/" title="Vue 키 포인트 소개" class="dd-item ">
        <a href="/Dev/Vue/1.intro_key_of_vue/">
        Vue 키 포인트 소개
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Dev/Vue/1.vue/" title="Vue 기본 개념" class="dd-item ">
        <a href="/Dev/Vue/1.vue/">
        Vue 기본 개념
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Dev/Vue/4.How-to-solving-the-problems-in-vuetify-upgrade-to-v2.x/" title="Vuetify v2.x 업그레이드" class="dd-item ">
        <a href="/Dev/Vue/4.How-to-solving-the-problems-in-vuetify-upgrade-to-v2.x/">
        Vuetify v2.x 업그레이드
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Dev/Vue/5.what-is-the-store-in-vuex/" title="Vuex의 Store란 무엇일까?" class="dd-item ">
        <a href="/Dev/Vue/5.what-is-the-store-in-vuex/">
        Vuex의 Store란 무엇일까?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Dev/Vue/6.How-to-use-vue-property-decorator/" title="vue-property-decorator 정리" class="dd-item ">
        <a href="/Dev/Vue/6.How-to-use-vue-property-decorator/">
        vue-property-decorator 정리
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Dev/Nuxt/" title="Nuxt" class="dd-item 
        
        
        
        ">
      <a href="/Dev/Nuxt/">
          Nuxt
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Dev/Nuxt/5.nuxt-tips/" title="Nuxt 활용 팁들 정리" class="dd-item ">
        <a href="/Dev/Nuxt/5.nuxt-tips/">
        Nuxt 활용 팁들 정리
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Dev/Nuxt/6.how-to-use-axios-in-nuxt/" title="Nuxt에 AXIOS 적용하기" class="dd-item ">
        <a href="/Dev/Nuxt/6.how-to-use-axios-in-nuxt/">
        Nuxt에 AXIOS 적용하기
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Dev/Go/" title="Go" class="dd-item 
        parent
        
        
        ">
      <a href="/Dev/Go/">
          Go
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Dev/Go/2.How-to-use-mongodb-with-go/" title="Golang으로 MongoDB 연결해 보기" class="dd-item active">
        <a href="/Dev/Go/2.How-to-use-mongodb-with-go/">
        Golang으로 MongoDB 연결해 보기
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Dev/Typescript/" title="Typescript" class="dd-item 
        
        
        
        ">
      <a href="/Dev/Typescript/">
          Typescript
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Dev/Typescript/1.typescript-problem-solving-and-tips/" title="Typescript 문제 해결및 팁들 정리" class="dd-item ">
        <a href="/Dev/Typescript/1.typescript-problem-solving-and-tips/">
        Typescript 문제 해결및 팁들 정리
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Dev/ETC/" title="ETC" class="dd-item 
        
        
        
        ">
      <a href="/Dev/ETC/">
          ETC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Dev/ETC/1.npm_vs_yarn/" title="NPM vs YARN" class="dd-item ">
        <a href="/Dev/ETC/1.npm_vs_yarn/">
        NPM vs YARN
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/FunnyLab/" title="FunnyLab" class="dd-item 
        
        
        
        ">
      <a href="/FunnyLab/">
          <b>4. </b>FunnyLab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/FunnyLab/Blogging/" title="Blogging" class="dd-item 
        
        
        
        ">
      <a href="/FunnyLab/Blogging/">
          Blogging
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/FunnyLab/Blogging/change-comments-to-utterances/" title="댓글 시스템 utterances로 변경" class="dd-item ">
        <a href="/FunnyLab/Blogging/change-comments-to-utterances/">
        댓글 시스템 utterances로 변경
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/FunnyLab/Blogging/how-to-deploy-api-server-to-heroku/" title="OGP API 서버 Heroku에 배포하기" class="dd-item ">
        <a href="/FunnyLab/Blogging/how-to-deploy-api-server-to-heroku/">
        OGP API 서버 Heroku에 배포하기
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> </a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p style="position:absolute;right:5%">
    © 2019 MSFL :: ccambo (Morris Chang)
  </p>
  </br>
  
  <p style="position:absolute;right:5%">
    Powered by
    <a href="//gohugo.io" target="_blank">HUGO</a>
  </p>
  </br>
  <p style="position:absolute;right:5%">
    Theme by
    <a href="//themes.gohugo.io/hugo-theme-learn/" target="_blank">LEARN (Mathieu Cornic)</a>
  </p>
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                  <div id="breadcrumbs" itemscope="" itemtype="http://schema.org/BreadcrumbList">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>MSFL</a> > <a href='/Dev/'>Dev</a> > <a href='/Dev/Go/'>Go</a> > Golang으로 MongoDB 연결해 보기
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#간단한-mongodb-정리">간단한 MongoDB 정리</a>
<ul>
<li><a href="#rdbms와의-비교">RDBMS와의 비교</a></li>
<li><a href="#특징과-장-단점">특징과 장/단점</a></li>
<li><a href="#메모리-관련-이슈">메모리 관련 이슈</a></li>
<li><a href="#주요-용어">주요 용어</a></li>
</ul></li>
<li><a href="#mongodb-실행하기-docker-compose">MongoDB 실행하기 (docker-compose)</a></li>
<li><a href="#golang으로-연결하기">Golang으로 연결하기</a>
<ul>
<li><a href="#import-구성">import 구성</a></li>
<li><a href="#클라이언트-연결과-검증-코드">클라이언트 연결과 검증 코드</a></li>
</ul></li>
<li><a href="#발생했던-문제점들">발생했던 문제점들</a>
<ul>
<li><a href="#applyuri에-mongodb-id-pw-localhost-27017-방식으로-구성할-때-오류"><strong>ApplyURI에 &ldquo;mongodb://ID:PW@localhost:27017&rdquo; 방식으로 구성할 때 오류</strong></a></li>
<li><a href="#데이터-처리할-때-unauthorized-command-insert-requires-authentication-오류">데이터 처리할 때 <strong>&rdquo;(Unauthorized) command insert requires authentication&rdquo; 오류</strong></a></li>
<li><a href="#연결할-때-authentication-mechanism-scram-sha-1-오류">연결할 때 <strong>Authentication mechanism SCRAM-SHA-1 오류</strong></a></li>
</ul></li>
<li><a href="#참고-문서">참고 문서</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
<div class="tags">

  <a class="tag-link" href="/tags/MongoDB">MongoDB</a>

  <a class="tag-link" href="/tags/mongo-driver">mongo-driver</a>

  <a class="tag-link" href="/tags/docker-compose">docker-compose</a>

</div>

        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Golang으로 MongoDB 연결해 보기
            </h1>
          

        




	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1122795820579236"
     data-ad-slot="8454132912"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<blockquote>
<p>이 문서에서는 아주 간단하게 Docker-compose를 이용해서 MongoDB를 구동하고 Golang을 통해서 연결하는 부분에 대해서 정리하고 있습니다.</br>
환경은 맥북, VSCode, Golang, Docker 등이 이미 설치되어 있는 것을 기준으로 합니다.</p>
</blockquote>

<h2 id="간단한-mongodb-정리">간단한 MongoDB 정리</h2>

<h3 id="rdbms와의-비교">RDBMS와의 비교</h3>







<table><caption class=top>RDB vs. NoSQL (MongoDB)</caption>
<thead>
<tr>
<th align="left">RDBMS</th>
<th align="left">MongoDB</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">Database</td>
<td align="left">Database</td>
</tr>

<tr>
<td align="left">Table</td>
<td align="left">Collection</td>
</tr>

<tr>
<td align="left">Tuple/Row</td>
<td align="left">Document</td>
</tr>

<tr>
<td align="left">Column</td>
<td align="left">Key/Field</td>
</tr>

<tr>
<td align="left">Table Join</td>
<td align="left">Embedded Documents</td>
</tr>

<tr>
<td align="left">Primary Key</td>
<td align="left">Primary Key (_id)</td>
</tr>
</tbody>
</table>


<h3 id="특징과-장-단점">특징과 장/단점</h3>

<p><strong>주요 특징</strong>들은 다음과 같다.</p>

<ul>
<li><strong>Document-Oriented Storage</strong> : Database &gt; Collections &gt; Documents 구조로 Document는 key-value 형태의 <a href="http://bsonspec.org/">BSON (Binary JSON)</a>으로 되어 있다.</li>
<li><strong>Full Index Support</strong> : 다양한 인덱싱을 제공한다.

<ul>
<li><strong>Single Field Indexes</strong> : 기본적인 인덱스 타입</li>
<li><strong>Compound Indexes</strong> : RDBMS의 복합 인덱스 타입</li>
<li><strong>Multikey Indexes</strong> : Array에 매칭되는 값이 하나라도 있으면 인덱스에 추가하는 인덱스 타입</li>
<li><strong>Geospatial Indexes and Queries</strong> : 위치기반 인덱스와 쿼리 지원</li>
<li><strong>Text Indexes</strong> : String에 대한 인덱스 지원</li>
<li><strong>Hashed Indexes</strong> : Btree 인덱스가 아닌 Hash 타입의 인덱스도 지원</li>
</ul></li>
<li><strong>Replication &amp; High Availablity</strong> : 간단한 설정을 통해서 데이터 복제를 지원하므로 가용성이 향상된다.</li>
<li><strong>Auto-Sharding</strong> : 자동으로 데이터를 분산해서 저장하며, 하나의 컬랙션처럼 사용할 수 있도록 수평적 확장 기능을 제공한다.</li>
<li><strong>Querying (Document based query)</strong> : 필터링, 수집, 정렬, 정규표현식 등의 다양한 쿼리문 지원</li>
<li><strong>Fast In-Place Updates</strong> : 고성능 atomic operation 지원</li>
<li><strong>Map/Reduce</strong> : 맵리듀스 지원 (map과 reduce 함수의 조합을 통해서 분산/병렬 시스템 운용 지원, 하둡처럼 MR전용 시스템에 비해서는 성능이 떨어진다)</li>
<li><strong>GridFS</strong> : 분산 파일 저장을 지원하기 때문에 실제 파일이 어디 저장되는지를 알 필요가 없으며 복구도 자동으로 지원된다.</li>
<li><strong>Commerical Support</strong> : 10gen에서 관리</li>
</ul>

<p><strong>장점</strong></p>

<p>데이터를 쌓아놓고 삭제가 필요없는 경우가 가장 적합하다. (ex. 로그 데이터 등)</p>

<ul>
<li><strong>Flexibility</strong> : Schema-less (or Schema-Free) 라서 어떤 형태의 데이터라도 저장이 가능하다.</li>
<li><strong>Performance</strong> : Read &amp; Write 성능이 뛰어나다.캐싱이나 많은 트래픽을 감당할때 사용해도 좋다.</li>
<li><strong>Scalability</strong> : 기본적으로 Scale-out 구조를 채택해서 쉽게 운용이 가능하다. Auto-Sharding 지원</li>
<li><strong>Deep Query Ability</strong> : 문서 지향적 Query Language를 사용해서 SQL만큼 강력한 Query성능을 제공한다.</li>
<li><strong>Conversion / Mapping</strong> : JSON 형태로 저장 (실제는 BSON) 되기 때문에 직관적이고 개발이 편리하다.</li>
</ul>

<p><strong>단점</strong></p>

<p>정합성이 요구되어 트랜잭션 관리가 필요한 경우는 부적합하다. (ex. 금융, 회계, 회원정보 등)</p>

<ul>
<li><strong>Join이 없다</strong> : JOIN이 필요없도록 데이터의 구조를 잡아야 한다.</li>
<li><strong>File 기반이다</strong> : Memroy mapped file 기반의 파일 엔진 DB이며 메모리 관리를 OS에 의존한다. 따라서 메모리 의존성이 있으며 메모리 크기가 성능을 좌우한다.</li>
<li><strong>SQL을 완전히 이관할 수 없다</strong> : SQL을 그대로 이전할 수 없으며 맞도록 변환해야 한다.</li>
<li><strong>BTree 성능 이슈가 있다</strong> : 인덱스를 BTree 기반으로 하고 있으므로 크기가 커질수록 새로운 데이터를 입력하거나 삭제할 때 성능이 저하된다. 따라서 데이터를 넣어두고 조회만 하는데 적합하다.</li>
</ul>

<h3 id="메모리-관련-이슈">메모리 관련 이슈</h3>

<p>데이터를 저장할 때 논리적으로 메모리에 먼저 저장하고 일정 주기에 따라서 메모리 블럭들을 디스크로 출력하는데 이 부분을 OS의 의존하고 있다. 실제 메모리가 작아도 OS의 가상메모리 운영 방식에 따라서 운영된다.</p>

<p>이런 운영 구조 때문에 메모리에서 데이터 블럭을 참조할 때 없다면 &ldquo;Page Fault&rdquo; 오류가 발생하고, 이 상황에서 디스크에서 해당 블록을 찾아서 메모리에 로드하여 처리하게 된다. 이 과정에서 모자라는 메모리 때문에 다른 블럭을 디스크에 쓰고 제거한 후 필요한 블럭을 메모리로 올리는 작업이 처리되기 때문에 디스크 I/O가 발생하므로 성능 저하가 발생할 수 밖에는 없다.</p>

<p>따라서 메모리 크기가 성능을 좌우한다는 것은 Page Fault 오류의 발생 반도에 근거하고 있다고 보면 된다. 따라서 데이터 설계를 할 때 자주 사용되는 데이터가 메모리에 상주할 수 있도록 key 설계를 하는 것이 매우 중요하다. 또한 테이블을 풀 스캔하는 작업은 무조건 Page Fault를 발생시키게 되므로 이런 경우는 Index Table (Summary Table) 등을 만들어서 운영하는 것이 성능을 위한 방법이라고 할 수 있다.</p>

<h3 id="주요-용어">주요 용어</h3>

<p><strong>Document</strong></p>

<p>RDBMS의 Tuple / Row와 대응되는 개념으로 Key-Value 쌍으로 구성되며, Value에는 또 다른 document가 설정될 수도 있다. 동적 스키마를 가지고 있기 때문에 같은 Collection (Table) 안에 있는 Document끼리도 다른 스키마를 가질 수 있다. (Free Schema)</p>

<figure class="code">
  <figcaption>
    <span>Document 샘플</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">{ 
  <span style="color:#e6db74">&#34;_id&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ObjectId</span>(<span style="color:#e6db74">&#34;5099803df3f4948bd2f98391&#34;</span>), 
  <span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Morris&#34;</span>, 
  <span style="color:#e6db74">&#34;language&#34;</span><span style="color:#f92672">:</span> { 
    <span style="color:#a6e22e">Nuxt</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
    <span style="color:#a6e22e">Go</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
  } 
}
</code></pre></div>
  </div>
</figure>

<p><strong>Primary Key</strong></p>

<p>RDBMS의 Primary Key와 대응되는 개념으로 ObjectId는 12bytes의 16진수 값으로 각 Document의 유일성을 보장하는 역할을 담당한다.</p>

<ul>
<li>4bytes : Timestamp Data</li>
<li>3bytes : Machine id Data</li>
<li>2bytes : MongoDB 서버의 Process id Data</li>
<li>3bytes : Sequenctial number Data</li>
</ul>

<p>개념적으로는 RDBMS의 auto increment와 비슷한 개념으로 생각하면 될 듯 하다.</p>

<blockquote>
<p>MongoDB에서 Collection에 저장된 각 Document들은 반드시 기본 키 역할을 담당하는 <strong>&ldquo;_id&rdquo;</strong> 라는 필드를 가져야 한다.</p>
</blockquote>

<p><strong>Collection</strong></p>

<p>RDBMS의 Table에 대응되는 개념으로 Document의 그룹이며, Document들이 Collection 내부에 위치한다.</p>

<p><strong>Database</strong></p>

<p>RDBMS의 Database에 대응되는 개념으로 Collection들의 물리적인 컨테이너다. 따라서 각 Database는 물리적인 파일 시스템에 여러 개의 파일로 저장된다.</p>

<h2 id="mongodb-실행하기-docker-compose">MongoDB 실행하기 (docker-compose)</h2>

<p>MongoDB 자체를 실행하는 것은 그렇게 어렵지 않다. 아래와 같이 아주 단순한 docker-compose.yml을 구성하면 바로 구동된다.</p>

<figure class="code">
  <figcaption>
    <span>docker-compose.yml - MongoDB 구성</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>version: <span style="color:#e6db74">&#34;3.3&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>services:
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  mongodb:
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    image: mongo:latest     <span style="color:#75715e"># 사용할 Docker Image</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    container_name: mongdb  <span style="color:#75715e"># Docker Container 식별 명</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    restart: always
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    environment:
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>      MONGO_INITDB_DATABASE: <span style="color:#e6db74">&#34;사용할 데이터베이스 명 설정&#34;</span>    <span style="color:#75715e"># 정보만 존재하고 실제 데이터가 처리될 때 생성됨.</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>      MONGO_INITDB_ROOT_USERNAME: <span style="color:#e6db74">&#34;root 사용자 설정&#34;</span>          <span style="color:#75715e"># 최초 실행되서 DB 구성할 때 사용자 생성됨.</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>      MONGO_INITDB_ROOT_PASSWORD: <span style="color:#e6db74">&#34;root 사용바 비밀번호 설정&#34;</span> <span style="color:#75715e"># 최초 실행되서 DB 구성할 때 사용자 생성됨.</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    volumes:
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>      - ./data/mongodb/:/data/db  <span style="color:#75715e"># 로컬 경로를 컨테이너의 볼륨으로 연계</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    ports:
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>      - <span style="color:#e6db74">&#34;27017:27017&#34;</span></span></code></pre></div>
  </div>
</figure>

<p>위와 같이 구성하고 docker-compose.yml 파일이 존재하는 경로에서 아래의 명령으로 실행하면 된다.</p>

<figure class="code">
  <figcaption>
    <span>docker-compose.yml 실행</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>$ docker-compose up
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#75715e"># Background로 실행하는 방법</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>$ docker-compose up -d
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span style="color:#75715e"># 로그 확인하는 방법</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>$ docker-compose logs</span></code></pre></div>
  </div>
</figure>

<p>로그를 확인해 보면 중간에 root 계정을 생성하는 것을 확인할 수 있으며, 인증 모드로 동작하고 있는 것을 확인할 수 있다.</p>

<figure class="code">
  <figcaption>
    <span>실행 로그 검증</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:38.416+0000 I  INDEX    <span style="color:#f92672">[</span>conn2<span style="color:#f92672">]</span> index build: <span style="color:#66d9ef">done</span> building index user_1_db_1 on ns admin.system.users
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>mongdb     | Successfully added user: <span style="color:#f92672">{</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>mongdb     |    <span style="color:#e6db74">&#34;user&#34;</span> : <span style="color:#e6db74">&#34;root&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>mongdb     |    <span style="color:#e6db74">&#34;roles&#34;</span> : <span style="color:#f92672">[</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>mongdb     |            <span style="color:#f92672">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>mongdb     |                    <span style="color:#e6db74">&#34;role&#34;</span> : <span style="color:#e6db74">&#34;root&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>mongdb     |                    <span style="color:#e6db74">&#34;db&#34;</span> : <span style="color:#e6db74">&#34;admin&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>mongdb     |            <span style="color:#f92672">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>mongdb     |    <span style="color:#f92672">]</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>mongdb     | <span style="color:#f92672">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.466+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> MongoDB starting : pid<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> port<span style="color:#f92672">=</span><span style="color:#ae81ff">27017</span> dbpath<span style="color:#f92672">=</span>/data/db <span style="color:#ae81ff">64</span>-bit host<span style="color:#f92672">=</span>7531e03b8054
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.466+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> db version v4.2.2
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.466+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> git version: a0bbbff6ada159e19298d37946ac8dc4b497eadf
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.466+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> OpenSSL version: OpenSSL <span style="color:#ae81ff">1</span>.1.1  <span style="color:#ae81ff">11</span> Sep <span style="color:#ae81ff">2018</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.467+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> allocator: tcmalloc
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.467+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> modules: none
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.467+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> build environment:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.468+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span>     distmod: ubuntu1804
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.468+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span>     distarch: x86_64
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.468+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span>     target_arch: x86_64
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>mongdb     | <span style="color:#ae81ff">2020</span>-01-07T10:58:48.468+0000 I  CONTROL  <span style="color:#f92672">[</span>initandlisten<span style="color:#f92672">]</span> options: <span style="color:#f92672">{</span> net: <span style="color:#f92672">{</span> bindIp: <span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#f92672">}</span>, security: <span style="color:#f92672">{</span> authorization: <span style="color:#e6db74">&#34;enabled&#34;</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span></span></code></pre></div>
  </div>
</figure>

<p>좀 더 많은 구성 옵션들과 실행과 관련된 스크립트들 (예를 들어 일반 사용자 추가 등)을 더 설정할 수 있지만, 여기서는 이 정도만 구성해도 충분하다.</p>

<h2 id="golang으로-연결하기">Golang으로 연결하기</h2>

<p>처음 Golang으로 연결하면서 여러 가지 정보들을 확인해 봤지만 Golang 버전에 따라서 Mongo Driver 들에 따라서 다양한 글들과 방법들이 나오지만 이런저런 오류들이 발생하면서 오히려 헷갈리는 상황들이 존재한다.</p>

<p>이 문서에는 Golang 버전의 MongoDB Official 격이라고 판단되는 <a href="https://github.com/mongodb/mongo-go-driver">mongo-go-driver</a>를 기준으로 한다.</p>

<h3 id="import-구성">import 구성</h3>

<p>아래의 코드는 mongodb driver의 go 라이브러리를 import 하는 것이다. 두 가지 방법 중에 무엇을 사용해도 상관없지만 코드 구성 후에 자동 import 처리되는 것을 확인해 보니 <font style="color:red;font-weight:bold">
  go.mongodb.org
</font>
로 사용되기 때문에 이를 기준으로 했다.</p>

<figure class="code">
  <figcaption>
    <span>import 구성</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#f92672">import</span> (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#75715e">// 다른 소스들은 아래와 같이 처리하는 것도 많다.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#75715e"></span>  <span style="color:#e6db74">&#34;github.com/mongodb/mongo-go-driver/bson&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#e6db74">&#34;github.com/mongodb/mongo-go-driver/bson/primitive&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#e6db74">&#34;github.com/mongodb/mongo-go-driver/mongo&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#e6db74">&#34;github.com/mongodb/mongo-go-driver/mongo/options&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  <span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#75715e">// 실제 코드는 CDN 격인 go.mongodb.org를 사용해서 처리했다.
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#75715e"></span>  <span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/bson&#34;</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/bson/primitive&#34;</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  <span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/mongo&#34;</span>
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  <span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/mongo/options&#34;</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#f92672">...</span></code></pre></div>
  </div>
</figure>

<h3 id="클라이언트-연결과-검증-코드">클라이언트 연결과 검증 코드</h3>

<p>구동 중인 mongodb가 authentication mode로 동작하고 있고, root 사용자만 만들어 놓은 상태기 때문에 이를 아래의 코드를 통해서 연결과 검증을 하면 된다.</p>

<figure class="code">
  <figcaption>
    <span>mongodb 연결과 검증</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#75715e">// timeout 기반의 Context 생성
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#75715e"></span><span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">WithTimeout</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">Timeout</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#75715e">// Authetication 처리를 위한 Client Option 구성 (docker-compose.yml에 구성한 port 기준)
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#75715e"></span><span style="color:#a6e22e">clientOptions</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">Client</span>().<span style="color:#a6e22e">ApplyURI</span>(<span style="color:#e6db74">&#34;mongodb://localhost:27017)
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#e6db74">  .SetAuth(options.Credential{
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#e6db74">    AuthSource: &#34;&#34;,   // 지금은 필요없음
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#e6db74">    Username: &#34;</span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span>.<span style="color:#a6e22e">yml에</span> <span style="color:#a6e22e">지정한</span> <span style="color:#a6e22e">사용자</span><span style="color:#e6db74">&#34;,
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#e6db74">    Password: &#34;</span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span>.<span style="color:#a6e22e">yml에</span> <span style="color:#a6e22e">지정한</span> <span style="color:#a6e22e">사용자</span> <span style="color:#a6e22e">비밀번호</span><span style="color:#960050;background-color:#1e0010">&#34;</span>,
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  })
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#75715e">// mongodb 연결
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#75715e"></span><span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mongo</span>.<span style="color:#a6e22e">Connect</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">clientOptions</span>)
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#75715e">// 연결 검증
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#75715e"></span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Ping</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#66d9ef">nil</span>)
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#f92672">...</span></code></pre></div>
  </div>
</figure>

<p>클라이언트 옵션에 더 많은 구성들이 있지만 이 부분들은 mongodb 매뉴얼등을 검토해 보면서 적용하면 된다.</p>

<h2 id="발생했던-문제점들">발생했던 문제점들</h2>

<h3 id="applyuri에-mongodb-id-pw-localhost-27017-방식으로-구성할-때-오류"><strong>ApplyURI에 &ldquo;mongodb://ID:PW@localhost:27017&rdquo; 방식으로 구성할 때 오류</strong></h3>

<blockquote>
<p>un-escaped character @ in user info 오류</p>
</blockquote>

<p>위의 같은 오류 메시지는 ID나 PW에 <strong>@</strong> 문자가 존재하는 경우에 직접 전달되면 발생하게 된다. 이를 해결하기 위해서는 <code>&quot;net/url&quot;</code> 패키지를 import 하고 아래와 같이 escape 처리를 해 줘야 한다.</p>

<figure class="code">
  <figcaption>
    <span>특수문자 escape 처리</span>
  </figcaption>
  <div class="codewrapper">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#f92672">import</span> (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#f92672">...</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#e6db74">&#34;net/url&#34;</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#f92672">...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#75715e">// getConnectionURI - Returns the connection URI from the configuration
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">getConnectionURI</span>(<span style="color:#a6e22e">conf</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#66d9ef">string</span> {
<span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;mongodb://&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">QueryEscape</span>(<span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">UserName</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">QueryEscape</span>(<span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">Password</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;@&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">Host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">Port</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">DatabaseName</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#f92672">...</span></code></pre></div>
  </div>
</figure>

<p><font style="color:red;font-weight:bold">
  url.QueryEscape
</font>
 함수를 이용해서 데이터에 존재하는 특수문자를 안전하게 인식될 수 있도록 변환해 주면 된다.</p>

<h3 id="데이터-처리할-때-unauthorized-command-insert-requires-authentication-오류">데이터 처리할 때 <strong>&rdquo;(Unauthorized) command insert requires authentication&rdquo; 오류</strong></h3>

<p>위에 언급했던 Authentication Mode로 구동되고 있는 mongodb에 인증을 처리하지 않고 Connection을 연결한 후 실제 데이터를 처리할 때 인증되지 않은 사용자로 인해서 발생하는 오류다. 이 경우는 위의 코드에서 보여진 것과 같이 인증을 한 Connection을 사용하면 오류가 해결된다.</p>

<blockquote>
<p><font style="color:red;font-weight:bold">
  Authentication 처리를 구성한 Client Option 사용한 연결
</font>
 처리가 필요하다.</p>
</blockquote>

<h3 id="연결할-때-authentication-mechanism-scram-sha-1-오류">연결할 때 <strong>Authentication mechanism SCRAM-SHA-1 오류</strong></h3>

<p>이 오류는 mongodb의 인증 방식에 대한 문제로 위에서 보여준 <strong>연결 문자열을 사용해서 처리</strong>할 떄 발생하는 오류로 인증 방식이 맞지 않아서 발생하게 된다. 이 부분에 대해서는 <a href="http://www.mongoing.com/docs/core/authentication-mechanisms.html">MongoDB Manual - Authentication Mechanisms</a>를 참고하면 된다.</p>

<p>제공되는 Authentication Mechanism은 다음과 같다.</p>

<ul>
<li>SCRAM</li>
<li>X.509 Certificate Authentication</li>
<li>LDAP Proxy Authentication (Enterprise)</li>
<li>Kerberos Authentication (Enterprise)</li>
</ul>

<p>표준 URI Connection Schema는 아래와 같다.</p>

<blockquote>
<p>mongodb://[username:password@]host1[:port1][&hellip;hostN[:portN]][/[database][?options]]</p>
</blockquote>

<p>위에서 보이는 것과 같이 여러 개의 host 연결 지정이 가능하고, 사용할 데이터베이스와 연결에 사용할 옵션들 지정이 가능하다.</p>

<p>옵션을 통해서 Authentication Mechanism을 지정할 수 있다. 자세한 내용은 <a href="https://docs.mongodb.com/manual/reference/connection-string/#connections-connection-options">Connection Options</a>을 참고한다.</p>

<blockquote>
<p>Connection String을 기준으로 각종 옵션을 적용해서 처리하는 것도 방법이지만 여러 가지 설정을 Configuration으로 처리하고 운영하기에는 Authenticated Client 를 사용하는 방식이 더 효율적인 것으로 판단된다.</p>
</blockquote>

<h2 id="참고-문서">참고 문서</h2>

<ul>
<li><a href="http://bcho.tistory.com/746">MongoDB Physical 데이터 저장 구조</a></li>
<li><a href="https://docs.mongodb.com/manual/">MongDB - Document</a></li>
<li><a href="https://junhobaik.github.io/mongodb-basic-crud/">MongoDB 기초 - CRUD 명령어</a></li>
<li><a href="https://siyoon210.tistory.com/130">SQL vs NoSQL (MySQL vs. MongoDB)</a></li>
</ul>



	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1122795820579236"
     data-ad-slot="8454132912"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>




<script src="https://utteranc.es/client.js"
        repo="ccambo/blog-comments"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/Dev/Go/" title="Go"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/Dev/Typescript/" title="Typescript" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1580172899"></script>
    <script src="/js/perfect-scrollbar.min.js?1580172899"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1580172899"></script>
    <script src="/js/jquery.sticky.js?1580172899"></script>
    <script src="/js/featherlight.min.js?1580172899"></script>
    <script src="/js/highlight.pack.js?1580172899"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1580172899"></script>
    <script src="/js/learn.js?1580172899"></script>
    <script src="/js/hugo-learn.js?1580172899"></script>

    <link href="/mermaid/mermaid.css?1580172899" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1580172899"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

